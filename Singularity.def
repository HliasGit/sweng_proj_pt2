Bootstrap: docker
From: ubuntu:22.04

%post
    # Set noninteractive mode for apt-get
    #this avoids installing tzdata, which is not useful for us
    export DEBIAN_FRONTEND=noninteractive

    # Update the package list and install dependencies
    apt-get update && apt-get install -y \
        build-essential \
        cmake \
        mpich \
        git 
        
    
    # clone the repository containing the project inside the container
    git clone --recursive https://github.com/HliasGit/sweng_proj_pt2.git /usr/sweng_proj_pt2
    cd /usr/sweng_proj_pt2/project/googletest
    mkdir build
    cd build
    cmake ..
    make
    make install

    cd /usr/sweng_proj_pt2/project
    rm -rf build
    chmod +x build.sh
    ./build.sh

%test
    cd /usr/sweng_proj_pt2/project/build
    mpirun -np 2 ./test_multiplication

%runscript
    cd /usr/sweng_proj_pt2/project/
    # Define the default command to run when the container starts
    mpirun -np 2 build/main
