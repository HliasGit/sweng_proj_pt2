Bootstrap: docker
From: ubuntu:20.04

%post
    # Set noninteractive mode for apt-get
    #this avoids installing tzdata, which shoould not be useful for us
    export DEBIAN_FRONTEND=noninteractive

    # Update the package list and install dependencies
    apt-get update && apt-get install -y \
        build-essential \
        cmake \
        mpich \
        git 
        
    # Install GoogleTest
    cd /opt
    git clone https://github.com/google/googletest.git
    cd googletest
    mkdir build
    cd build
    cmake ..
    make
    make install

    # clone the repository containing the project inside the container
    git clone https://github.com/HliasGit/sweng_proj_pt2.git

%environment
    # Set environment variables
    export PATH=/usr/local/bin:$PATH

%post
    # Build the project inside the container
    cd /project
    rm -rf build
    chmod +x build.sh
    ./build.sh

%test
    # Test the built project, ths may not be needed, since the tests should
    # regard the container itself, not the programs inside it
    cd /project/build
    mpirun -np 2 ./test_multiplication

%runscript
    # Define the default command to run when the container starts
    exec /project/build/test_multiplication
